services:
  journal:
    build: .
    ports:
      - "8080:8080"
    environment:
      # Database connection (point to your external PostgreSQL)
      # On macOS/Windows: use host.docker.internal
      # On Linux: use 172.17.0.1 or host IP
      DATABASE_URL: postgresql://journal:journaldev@host.docker.internal:5432/journal?sslmode=disable
      # Server config
      SERVER_PORT: "8080"
      SERVER_ENV: production
      # SPA config
      SPA_MODE: embed
      SPA_DIR: /app/web/dist
      # Ollama (if running locally)
      OLLAMA_BASE_URL: http://host.docker.internal:11434
      # LLM config
      LLM_EMBEDDING_MODEL: nomic-embed-text
      LLM_CHAT_MODEL: llama3.2
      LLM_VECTOR_DIMENSIONS: "768"
      LLM_ENABLE_VECTOR_SEARCH: "true"
    volumes:
      # Persist config file
      - ./config.yaml:/app/config.yaml
    restart: unless-stopped
